pkgname=firmware-fxtec-qx1050
pkgver=1
pkgrel=0
pkgdesc="Firmware for F(x)tec Pro1x (QX1050)"
subpackages="
	$pkgname-adreno
	$pkgname-radio
	$pkgname-rproc
	"
url="https://github.com/zstas/fxtec-pro1x-firmware"
arch="aarch64"
license="proprietary"
makedepends="pil-squasher"
options="!check !strip !archcheck !tracedeps pmb:cross-native"
_commit="f52d17cb759b9132b327f5cd10dc8c1b69d8d238"
source="$pkgname-$_commit.tar.gz::https://github.com/zstas/fxtec-pro1x-firmware/archive/$_commit.tar.gz"
builddir="$srcdir/fxtec-pro1x-firmware-$_commit"

build() {
	pil-squasher a610_zap.mbn a610_zap.mdt
	pil-squasher adsp.mbn adsp.mdt
	pil-squasher cdsp.mbn cdsp.mdt
	pil-squasher modem.mbn modem.mdt
	pil-squasher venus.mbn venus.mdt
}

package() {
	# parent package is empty
	mkdir -p "$pkgdir"
}

adreno() {
	pkgdesc="Fxtec Pro1x (QX1050) adreno firmware"

	install -Dm644 "$builddir"/a610_zap.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/a630_sqe.fw -t \
		"$subpkgdir/lib/firmware/qcom/"
}

radio() {
	pkgdesc="Fxtec Pro1x (QX1050) radio firmware"

	install -Dm644 "$builddir"/board-2.bin -t \
		"$subpkgdir/lib/firmware/ath10k/WCN3990/hw1.0/"
	install -Dm644 "$builddir"/firmware-5.bin -t \
		"$subpkgdir/lib/firmware/ath10k/WCN3990/hw1.0/"
	install -Dm644 "$builddir"/adsp.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/cdsp.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/modem.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/modemuw.jsn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/venus.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
	install -Dm644 "$builddir"/wlanmdsp.mbn -t \
		"$subpkgdir/lib/firmware/qcom/sm6115/Fxtec/QX1050/"
}

rproc() {
	pkgdesc="Modem and Wifi services and configuration"
	depends="
		rmtfs
		tqftpserv
		tqftpserv-openrc
		pd-mapper
		pd-mapper-openrc
	"
	install="$subpkgname.post-install $subpkgname.post-upgrade"
	mkdir "$subpkgdir"
}

sha512sums="
c46658bc9536dd7bdb97aa787c5c3f2093fc27f7279d2ca48baf88030c7ff671ae09632b980c61fad9dad91cb57b5ebd8d5f773bf85b92f48249987946e6ccda  firmware-fxtec-qx1050-f52d17cb759b9132b327f5cd10dc8c1b69d8d238.tar.gz
"
